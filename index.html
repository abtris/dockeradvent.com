<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Docker Advent &middot; Small thoughts about docker in advent
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Docker Advent
        </a>
      </h1>
      <p class="lead">Made by <a href="https://twitter.com/abtris" target="_blank">@abtris</a>.</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item active" href="/">Home</a>

      

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
      
        
      
        
          
        
      
        
      
        
          
        
      
        
          
        
      

      <a class="sidebar-nav-item" href="https://github.com/abtris/dockeradvent.com">GitHub project</a>
    </nav>

    <p>&copy; 2015. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/12/24/day-twenty-four-docker-advent-summary/">
        Day Twenty Four - Docker Advent Summary 2015
      </a>
    </h1>

    <span class="post-date">24 Dec 2015</span>

    <p>Hi everyone,<br>
this is last post for year 2015.</p>

<p>Here is summary all posts in 2015:</p>

<ul>
<li><a href="http://www.dockeradvent.com/2015-12-01-day-one-what-is-docker">Day One - What&#39;s docker?</a></li>
<li><a href="http://www.dockeradvent.com/2015-12-02-day-two-open-container-ecosystem">Day Two - Open Container Ekosystem</a></li>
<li><a href="http://www.dockeradvent.com/2015-12-03-day-three-docker-install-upgrade">Day Three - Docker install and upgrade</a></li>
<li><a href="http://www.dockeradvent.com/2015-12-04-day-four-docker-machine">Day Four - Docker Machine</a></li>
<li><a href="http://www.dockeradvent.com/2015-12-05-day-five-docker-compose-part-1">Day Five - Docker Compose Part 1</a></li>
<li><a href="http://www.dockeradvent.com/2015-12-06-day-six-dockerhub">Day Six - Docker Hub</a></li>
<li><a href="http://www.dockeradvent.com/2015-12-07-day-seven-dockerfile">Day Seven - Dockerfile</a></li>
<li><a href="http://www.dockeradvent.com/2015-12-08-day-eight-docker-compose-part-2">Day Eight - Docker Compose Part 2</a></li>
<li><a href="http://www.dockeradvent.com/2015-12-09-day-nine-docker-registry">Day Nine - Docker Registry</a></li>
<li><a href="http://www.dockeradvent.com/2015-12-10-day-ten-docker-swarm">Day Ten - Docker Swarm</a></li>
<li><a href="http://www.dockeradvent.com/2015-12-11-day-eleven-docker-version-manager">Day Eleven - Docker Version Manager</a></li>
<li><a href="http://www.dockeradvent.com/2015-12-12-day-twelve-docker-and-circleci">Day Twelve - CircleCI and Docker</a></li>
<li><a href="http://www.dockeradvent.com/2015-12-13-day-thirteen-docker-and-travisci">Day Thirteen - Docker and TravisCI</a></li>
<li><a href="http://www.dockeradvent.com/2015-12-14-day-fourteen-docker-lifecycle">Day Fourteen - Docker Lifecycle</a></li>
<li><a href="http://www.dockeradvent.com/2015-12-15-day-fifteen-container-lifecycle">Day Fifteen - Container Lifecycle</a></li>
<li><a href="http://www.dockeradvent.com/2015-12-16-day-sixteen-using-docker-for-cli-tools">Day Sixteen - Using docker for CLI Tools</a></li>
<li><a href="http://www.dockeradvent.com/2015-12-17-day-seventeen-docker-and-sphinx-documentation">Day Seventeen - Docker and Sphinx documentation</a></li>
<li><a href="http://www.dockeradvent.com/2015-12-18-day-eighteen-docker-and-heroku">Day Eighteen - Docker and Heroku</a></li>
<li><a href="http://www.dockeradvent.com/2015-12-19-day-nineteen-docker-and-aws-ecs">Day Nineteen - Docker and AWS ECS</a></li>
<li><a href="http://www.dockeradvent.com/2015-12-20-day-twenty-docker-and-tutum">Day Twenty - Docker and Tutum</a></li>
<li><a href="http://www.dockeradvent.com/2015-12-21-day-twenty-one-docker-and-logging">Day Twenty One - Docker and logging</a></li>
<li><a href="http://www.dockeradvent.com/2015-12-22-day-twenty-two-docker-and-monitoring">Day Twenty Two - Docker and monitoring</a></li>
<li><a href="http://www.dockeradvent.com/2015-12-23-day-twenty-three-docker-tips-and-tricks">Day Twenty Three - Docker tips and tricks</a></li>
<li><a href="http://www.dockeradvent.com/2015/12/24/day-twenty-four-docker-advent-summary/">Day Twenty Four - Docker Advent Summary 2015</a></li>
</ul>

<p>I hope, these posts can be useful. The posts order is chaotic. I think next year I have more time and some co-authors to make this better.</p>

<p>In 2016 have to docker show us how deploy docker container fast and scalable. Problems I see in containers size and I hope many containers change base from Ubuntu to Alpine.</p>

<p>See you in 2016,<br>
Ladislav</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/12/23/day-twenty-three-docker-tips-and-tricks/">
        Day Twenty Three - Docker tips and tricks
      </a>
    </h1>

    <span class="post-date">23 Dec 2015</span>

    <p>Hi everyone,<br>
this is last but one post before Christmas.</p>

<h3>1. Get IP address of your container</h3>
<div class="highlight"><pre><code class="language-text" data-lang="text">docker inspect -f &#39;&#39; $ID
</code></pre></div>
<p>example:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ docker inspect -f &#39;&#39; 9dd74d9998bb

{&quot;Bridge&quot;:&quot;&quot;,&quot;SandboxID&quot;:&quot;&quot;,&quot;HairpinMode&quot;:false,&quot;LinkLocalIPv6Address&quot;:&quot;&quot;,&quot;LinkLocalIPv6PrefixLen&quot;:0,&quot;Ports&quot;:null,&quot;SandboxKey&quot;:&quot;&quot;,&quot;SecondaryIPAddresses&quot;:null,&quot;SecondaryIPv6Addresses&quot;:null,&quot;EndpointID&quot;:&quot;&quot;,&quot;Gateway&quot;:&quot;&quot;,&quot;GlobalIPv6Address&quot;:&quot;&quot;,&quot;GlobalIPv6PrefixLen&quot;:0,&quot;IPAddress&quot;:&quot;&quot;,&quot;IPPrefixLen&quot;:0,&quot;IPv6Gateway&quot;:&quot;&quot;,&quot;MacAddress&quot;:&quot;&quot;,&quot;Networks&quot;:{&quot;bridge&quot;:{&quot;EndpointID&quot;:&quot;&quot;,&quot;Gateway&quot;:&quot;&quot;,&quot;IPAddress&quot;:&quot;&quot;,&quot;IPPrefixLen&quot;:0,&quot;IPv6Gateway&quot;:&quot;&quot;,&quot;GlobalIPv6Address&quot;:&quot;&quot;,&quot;GlobalIPv6PrefixLen&quot;:0,&quot;MacAddress&quot;:&quot;&quot;}}}
</code></pre></div>
<p>if you can have nice output you can use python or <a href="https://stedolan.github.io/jq/">jq</a>.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ docker inspect -f &#39;&#39; $ID | python -mjson.tool
</code></pre></div>
<p>or</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ docker inspect -f &#39;&#39; $ID | jq
</code></pre></div>
<p>jq have nice colored output:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;Bridge&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
  <span class="nt">&quot;SandboxID&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
  <span class="nt">&quot;HairpinMode&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nt">&quot;LinkLocalIPv6Address&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
  <span class="nt">&quot;LinkLocalIPv6PrefixLen&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="nt">&quot;Ports&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nt">&quot;SandboxKey&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
  <span class="nt">&quot;SecondaryIPAddresses&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nt">&quot;SecondaryIPv6Addresses&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nt">&quot;EndpointID&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
  <span class="nt">&quot;Gateway&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
  <span class="nt">&quot;GlobalIPv6Address&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
  <span class="nt">&quot;GlobalIPv6PrefixLen&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="nt">&quot;IPAddress&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
  <span class="nt">&quot;IPPrefixLen&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="nt">&quot;IPv6Gateway&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
  <span class="nt">&quot;MacAddress&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
  <span class="nt">&quot;Networks&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;bridge&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;EndpointID&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
      <span class="nt">&quot;Gateway&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
      <span class="nt">&quot;IPAddress&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
      <span class="nt">&quot;IPPrefixLen&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nt">&quot;IPv6Gateway&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
      <span class="nt">&quot;GlobalIPv6Address&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
      <span class="nt">&quot;GlobalIPv6PrefixLen&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nt">&quot;MacAddress&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>I like <code>jq</code> it&#39;s quite useful for manipulating, selection data from JSON. It&#39;s good to know this tool.</p>

<p>If you have one running container you can easy get ID from <code>docker ps</code> command.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ docker inspect -f &#39;&#39; $(docker ps -q)
</code></pre></div>
<h3>2. Cleanup your docker machine</h3>

<p>If you see message about running out of space. Cleanup machine.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># Delete all containers
docker rm $(docker ps -a -q)
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text"># Delete all images
docker rmi $(docker images -q)
</code></pre></div>
<p>You can remove only containers or both. Depends at your use case.</p>

<h3>3. Docker cheet sheet</h3>

<p>Print this or <a href="https://github.com/wsargent/docker-cheat-sheet">bookmark</a>.</p>

<h3>4. Environment properties in container</h3>

<p>This is useful if you have <code>--link</code> parameter. Get <code>CONTAINER_ID</code> of running container using <code>docker ps</code> and use <code>docker exec</code> to show all environment properties.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$  docker exec &lt;CONTAINER_ID&gt; env

PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
HOSTNAME=dda0a7c94a09
TERM=xterm
REDIS_PORT=tcp://172.17.0.2:6379
REDIS_PORT_6379_TCP=tcp://172.17.0.2:6379
REDIS_PORT_6379_TCP_ADDR=172.17.0.2
REDIS_PORT_6379_TCP_PORT=6379
REDIS_PORT_6379_TCP_PROTO=tcp
REDIS_NAME=/jovial_ramanujan/redis
REDIS_ENV_REDIS_VERSION=3.0.5
REDIS_ENV_REDIS_DOWNLOAD_URL=http://download.redis.io/releases/redis-3.0.5.tar.gz
REDIS_ENV_REDIS_DOWNLOAD_SHA1=ad3ee178c42bfcfd310c72bbddffbbe35db9b4a6
HOME=/root
</code></pre></div>
<p>If you can show <code>env</code> in image just run <code>docker run &lt;IMAGE_NAME&gt; env</code>.</p>

<h3>5. Minimal docker image</h3>

<p>You can use empty image called <a href="https://hub.docker.com/_/scratch/">scratch</a> or small image as <a href="https://hub.docker.com/_/alpine/">alpine</a>. <a href="http://alpinelinux.org/">Alpine Linux</a> is very small secure linux distribution. Image have 5MB and package repository to possibility install necessary things.</p>

<p>Use like you would any other base image:</p>
<div class="highlight"><pre><code class="language-dockerfile" data-lang="dockerfile"><span class="k">FROM</span> alpine:3.1
<span class="k">RUN</span> apk add --update mysql-client <span class="o">&amp;&amp;</span> rm -rf /var/cache/apk/*
<span class="k">ENTRYPOINT</span> <span class="o">[</span><span class="s2">&quot;mysql&quot;</span><span class="o">]</span>
</code></pre></div>
<p>This example has a virtual image size of only 16 MB. Compare that to our good friend Ubuntu:</p>
<div class="highlight"><pre><code class="language-dockerfile" data-lang="dockerfile"><span class="k">FROM</span> ubuntu:14.04
<span class="k">RUN</span> apt-get update <span class="err">\</span>
    <span class="o">&amp;&amp;</span> apt-get install -y mysql-client <span class="err">\</span>
    <span class="o">&amp;&amp;</span> rm -rf /var/lib/apt/lists/*
<span class="k">ENTRYPOINT</span> <span class="o">[</span><span class="s2">&quot;mysql&quot;</span><span class="o">]</span>
</code></pre></div>
<p>This yields us a virtual image size of about 232 MB image.</p>

<p>I think this is very useful.</p>

<p>See you tomorrow,<br>
Ladislav</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/12/22/day-twenty-two-docker-and-monitoring/">
        Day Twenty Two - Docker and monitoring
      </a>
    </h1>

    <span class="post-date">22 Dec 2015</span>

    <p>Hi everyone,<br>
Docker have <a href="https://docs.docker.com/engine/articles/runmetrics/">runtime metrics</a>, you can see CPU, MEM, IO and network for every container.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ docker stats determined_shockley determined_wozniak prickly_hypatia
CONTAINER             CPU %               MEM USAGE/LIMIT       MEM %               NET I/O
determined_shockley   0.00%               884 KiB/1.961 GiB     0.04%               648 B/648 B
determined_wozniak    0.00%               1.723 MiB/1.961 GiB   0.09%               1.266 KiB/648 B
prickly_hypatia       0.00%               740 KiB/1.961 GiB     0.04%               1.898 KiB/648 B
</code></pre></div>
<p>It&#39;s many tools for monitoring:</p>

<ul>
<li><a href="https://github.com/google/cadvisor">cAdvisor</a> from google have web UI.</li>
<li>I&#39;m using <a href="https://www.datadoghq.com/blog/monitor-docker-datadog/">Datadog</a>.</li>
<li><a href="http://sensuapp.org/">Sensu Monitoring Framework</a> you can use with <a href="https://registry.hub.docker.com/u/hiroakis/docker-sensu-server/">container</a>.</li>
<li><a href="http://prometheus.io/">Prometheus</a> is an open-source service monitoring system and time series database.</li>
<li><a href="https://scoutapp.com/plugin_urls/19761-docker-monitor">Scout</a></li>
</ul>

<p>All monitoring works at some principles. Install agent on host and using docker stats and StatsD for sending data into some collection system.</p>

<p>See you tomorrow,<br>
Ladislav</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/12/21/day-twenty-one-docker-and-logging/">
        Day Twenty One - Docker and logging
      </a>
    </h1>

    <span class="post-date">21 Dec 2015</span>

    <p>Hi everyone,<br>
every container can have different <a href="https://docs.docker.com/engine/reference/logging/overview/">logging driver</a>.</p>

<p>In version 1.9 is supported this drivers:</p>

<ul>
<li>json-file (Default logging driver for Docker. Writes JSON messages to file.)</li>
<li>syslog (Syslog logging driver for Docker. Writes log messages to syslog.)</li>
<li>journald (Journald logging driver for Docker. Writes log messages to journald.)</li>
<li>gelf (Graylog Extended Log Format (GELF) logging driver for Docker. Writes log  messages to a GELF endpoint likeGraylog or Logstash.)</li>
<li>fluentd (Fluentd logging driver for Docker. Writes log messages to fluentd (forward input).)</li>
<li>awslogs (Amazon CloudWatch Logs logging driver for Docker. Writes log messages to Amazon CloudWatch Logs.
)</li>
</ul>

<p>All options you can find in <a href="https://docs.docker.com/engine/reference/logging/overview/">documentation</a>.</p>

<p>If you can use some hosted services as <a href="http://help.papertrailapp.com/kb/configuration/configuring-centralized-logging-from-docker/">Papertrail</a>, <a href="https://www.loggly.com/docs/docker-syslog/">Loggly</a> or <a href="https://www.sumologic.com/application/docker/">Sumologic</a>.</p>

<p>Setup logging for all docker container is necessary for debugging. If you can use ELK (<a href="http://nathanleclaire.com/blog/2015/04/27/automating-docker-logging-elasticsearch-logstash-kibana-and-logspout/">Elastic search, Logstash, Kibana</a>). You can use <a href="https://github.com/gliderlabs/logspout">logspout</a> to <a href="https://github.com/looplab/logspout-logstash">send logs to logstash</a>.</p>

<p>See you tomorrow,<br>
Ladislav</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/12/20/day-twenty-docker-and-tutum/">
        Day Twenty - Docker and Tutum
      </a>
    </h1>

    <span class="post-date">20 Dec 2015</span>

    <p>Hi everyone,<br>
<a href="https://www.tutum.co/">Tutum</a> is docker platform for Dev and Ops. Tutum <a href="http://blog.tutum.co/2015/10/21/docker-tutum/">join</a> Docker in October 2015.</p>

<p>Tutum have some cool features:</p>

<ul>
<li>internal docker registry</li>
<li>build from git</li>
<li>deploy to different cloud providers

<ul>
<li>Amazon Web Services</li>
<li>Microsoft Azure</li>
<li>Digital Ocean</li>
<li>IBM Softlayer</li>
</ul></li>
<li>logging, monitoring, scaling</li>
<li>API</li>
<li>support for docker-compose</li>
<li>CLI client</li>
</ul>

<p>I think this abstraction is very cool for many starting developers. You can use standard docker tools and all works out of the box. Tutum is still in beta but future is near and together with Docker they can be main player in deployment docker applications in the future.</p>

<p>See you tomorrow,<br>
Ladislav</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/12/19/day-nineteen-docker-and-aws-ecs/">
        Day Nineteen - Docker and AWS ECS
      </a>
    </h1>

    <span class="post-date">19 Dec 2015</span>

    <p>Hi everyone,<br>
Amazon Web Services (AWS) is biggest cloud provider and you can use docker with Elastic Compute Cloud (EC2), use Amazon EC2 Container Service (ECS) or AWS Elastic Beanstalk. <a href="https://aws.amazon.com/elasticbeanstalk/">AWS Elastic Beanstalk</a> is very similar to Heroku. It&#39;s Platform as a Service (PaaS).</p>

<p>I write post about ECS. ECS is new service exists two years. You have to use your EC2 instances to provide cluster. No price for service itself only for resources (EC2, ELB, EBS).</p>

<p>This year <a href="https://github.com/aws/amazon-ecs-cli">Amazon ECS CLI</a> introduce support for <code>docker-compose.yml</code>.</p>

<p>I use this command to create task definition for ECS using this command:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">AWS_REGION=us-east-1 ecs-cli compose create
</code></pre></div>
<p>this is example <code>docker-compose.yml</code> for docker registry:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">backend:
  image: registry
  cpu_shares: 400
  mem_limit: 314572800
  ports:
    - 5000:5000
  environment:
    AWS_BUCKET: &lt;DOCKER-REGISTRY-BUCKET&gt;
    AWS_ENCRYPT: &#39;False&#39;
    AWS_KEY: &lt;AWS-KEY&gt;
    AWS_REGION: us-east-1
    AWS_SECRET: &lt;AWS-SECRET&gt;
    AWS_SECURE: &#39;False&#39;
    AWS_USE_SIGV4: &#39;False&#39;
    SETTINGS_FLAVOR: prod
    SEARCH_BACKEND: sqlalchemy
    REGISTRY_AUTH: htpasswd
    REGISTRY_AUTH_HTPASSWD_REALM: &#39;Auth Internal Registry&#39;
    REGISTRY_AUTH_HTPASSWD_PATH: /auth/htpasswd
</code></pre></div>
<p>For running cluster you need <a href="http://docs.aws.amazon.com/AmazonECS/latest/developerguide/launch_container_instance.html">setup instances</a> and register these instances into cluster. You can use <a href="http://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs-agent-config.html#ecs-config-s3">ecs.config</a> in user data to setup instance.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">#!/bin/bash
yum install -y aws-cli
aws s3 cp s3://&lt;BUCKET-NAME&gt;/ecs.config /etc/ecs/ecs.config
echo ECS_CLUSTER=&lt;CLUSTER-NAME&gt; &gt;&gt; /etc/ecs/ecs.config
</code></pre></div>
<p>You can run task or service in ECS. If you need task as cron you can use lambda for setup <a href="http://stackoverflow.com/questions/27382009/aws-lambda-scheduled-tasks">scheduling task</a>.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">AWS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;aws-sdk&#39;</span><span class="p">);</span>
<span class="nx">AWS</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">region</span> <span class="o">=</span> <span class="s1">&#39;us-east-1&#39;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">ecs</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AWS</span><span class="p">.</span><span class="nx">ECS</span><span class="p">();</span>

<span class="kr">const</span> <span class="nx">MAX_RESULTS</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">runTask</span><span class="p">(</span><span class="nx">taskDefinitionArn</span><span class="p">,</span> <span class="nx">clusterName</span><span class="p">,</span> <span class="nx">numberOfTasks</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">taskDefinition</span><span class="o">:</span> <span class="nx">taskDefinitionArn</span><span class="p">,</span> <span class="cm">/* required */</span>
    <span class="nx">cluster</span><span class="o">:</span> <span class="nx">clusterName</span><span class="p">,</span>
    <span class="nx">count</span><span class="o">:</span> <span class="nx">numberOfTasks</span><span class="p">,</span>
    <span class="nx">overrides</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="nx">startedBy</span><span class="o">:</span> <span class="s1">&#39;nodejs-script&#39;</span>
  <span class="p">};</span>
  <span class="nx">ecs</span><span class="p">.</span><span class="nx">runTask</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nx">stack</span><span class="p">);</span> <span class="c1">// an error occurred</span>
    <span class="k">else</span>     <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>           <span class="c1">// successful response</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">context</span><span class="p">.</span><span class="nx">succeed</span><span class="p">(</span><span class="nx">runTask</span><span class="p">(</span><span class="s1">&#39;&lt;TASK-NAME&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;CLUSTER-NAME&gt;&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
<span class="p">};</span>
</code></pre></div>
<p>If you can run service it&#39;s similar but service is still alive. You can combine ECS with <a href="https://mesosphere.github.io/marathon/">Marathon</a> or <a href="http://mesos.github.io/chronos/">Chronos</a>.</p>

<p>See you tomorrow,<br>
Ladislav</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/12/18/day-eighteen-docker-and-heroku/">
        Day Eighteen - Docker and Heroku
      </a>
    </h1>

    <span class="post-date">18 Dec 2015</span>

    <p>Hi everyone,<br>
many PaaS (platform as service) support docker for deployment. I can write some posts about this. I start with Heroku.</p>

<p>Heroku introduce have own container solution for many years and <a href="https://devcenter.heroku.com/articles/docker">docker solution</a> converts docker images into their format. You can combine <code>git push heroku master</code> with <code>heroku docker:release</code> and both works together.</p>

<p>First, you have to update your heroku client and add docker plugin.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">heroku plugins:install heroku-docker
</code></pre></div>
<p>second, edit or create your <code>app.json</code> and add <code>image</code>.</p>

<p>Heroku maintains Docker images for most of the languages that we support:</p>

<ul>
<li>heroku/nodejs</li>
<li>heroku/ruby</li>
<li>heroku/jruby</li>
<li>heroku/python</li>
<li>heroku/scala</li>
<li>heroku/clojure</li>
<li>heroku/gradle</li>
<li>heroku/java</li>
<li>heroku/go</li>
<li>heroku/go-gb</li>
</ul>

<p>Third, you need <code>Procfile</code> as normal heroku app. And run <code>heroku docker:init</code>. Heroku create <code>Dockerfile</code> and <code>docker-compose.yml</code> file for you.</p>

<p>For local development just run <code>docker-compose up web</code> and app can be open at <code>open &quot;http://$(docker-machine ip default):8080&quot;</code></p>

<p>If you need shell (for example for Ruby app), you can run <code>docker-compose run shell</code>.</p>

<p>Rebuild container using <code>docker-compose build</code>. This you need if you change config or app.</p>

<p>Deploy is easy.</p>

<ol>
<li>Create Heroku app: <code>heroku create</code></li>
<li>Push slug into Heroku: <code>heroku docker:release</code></li>
<li>Open app in browser: <code>heroku open</code></li>
</ol>

<p>All docker images from heroku you can find at <a href="https://hub.docker.com/r/heroku/">dockerhub</a>.</p>

<p>If you need some special Dockerfile you can <a href="https://devcenter.heroku.com/articles/docker#modifying-the-dockerfile">make own</a>. This steps have some <a href="https://devcenter.heroku.com/articles/docker#limitations">limitations</a> if you use own buildpack you have to use standard pipeline.</p>

<p>See you tomorrow,<br>
Ladislav</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/12/17/day-seventeen-docker-and-sphinx-documentation/">
        Day Seventeen - Docker and Sphinx documentation
      </a>
    </h1>

    <span class="post-date">17 Dec 2015</span>

    <p>Hi everyone,<br>
if you write the docs, you can use <a href="http://sphinx-doc.org/">Sphinx</a>. You can share your documentation using <a href="https://readthedocs.org/">Read the Docs</a> portal.</p>

<p>If you look at <a href="https://docs.readthedocs.org/en/latest/getting_started.html#write-your-docs">quickstart</a> how write the docs, you can install python and some tools. This can be complicated if you can use latex for creating PDF version and do you need another version python for your development and some another for write the docs. Some members of your team can&#39;t install anything for update just a few lines.</p>

<h2>Docker solution for Sphinx</h2>

<p>You can use <a href="https://hub.docker.com/r/apiaryio/base-sphinx-doc-dev/">docker image</a>. There is <code>requirements.txt</code> for all python packages:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">Sphinx&gt;=1.3.1
awscli==1.5.2
sphinx_rtd_theme
recommonmark
</code></pre></div>
<p>and Dockerfile based on debian.</p>
<div class="highlight"><pre><code class="language-dockerfile" data-lang="dockerfile"><span class="k">FROM</span>        debian:jessie
<span class="k">MAINTAINER</span>  Apiary &lt;sre@apiary.io&gt;

<span class="k">ENV</span> REFRESHED_AT 2015-11-03

COPY requirements.txt /tmp/

<span class="k">RUN</span> apt-get clean <span class="o">&amp;&amp;</span> <span class="err">\</span>
    apt-get update <span class="o">&amp;&amp;</span> <span class="err">\</span>
    apt-get install -y --no-install-recommends python-sphinx <span class="err">\</span>
    graphviz <span class="err">\</span>
    make <span class="err">\</span>
    python-pip <span class="o">&amp;&amp;</span> <span class="err">\</span>
    pip install -r /tmp/requirements.txt <span class="o">&amp;&amp;</span> <span class="err">\</span>
    rm -rf /usr/share/doc/* <span class="o">&amp;&amp;</span> <span class="err">\</span>
    rm -rf /usr/share/locale/* <span class="o">&amp;&amp;</span> <span class="err">\</span>
    rm -rf /var/cache/debconf/*-old <span class="o">&amp;&amp;</span> <span class="err">\</span>
    rm -rf /var/lib/apt/lists/* <span class="o">&amp;&amp;</span> <span class="err">\</span>
    apt-get autoclean -y <span class="o">&amp;&amp;</span> <span class="err">\</span>
    apt-get autoremove -y

<span class="k">RUN</span> mkdir /mnt/docs

<span class="k">WORKDIR</span> /mnt/docs
<span class="k">VOLUME</span> <span class="o">[</span><span class="s1">&#39;/mnt/docs&#39;</span><span class="o">]</span>

<span class="k">CMD</span> make clean html
</code></pre></div>
<p>for running in repository with documentation you can use simple shell script, with support html and latex version. <a href="https://github.com/apiaryio/docker-base-images/blob/master/sphinx-latex-doc-dev/Dockerfile">Latex image size</a> is more than 1GB. Html version have only 100MB.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">#!/bin/bash
if [[ &quot;$@&quot; =~ latex.* ]]; then
    echo &quot;Building with LaTex image&quot;
    docker run -ti --rm -v $(pwd):/mnt/docs:rw -w /mnt/docs apiaryio/base-sphinx-latex-doc-dev $@
else
    echo &quot;Building with html-only image&quot;
    docker run -ti --rm -v $(pwd):/mnt/docs:rw -w /mnt/docs apiaryio/base-sphinx-doc-dev $@
fi
</code></pre></div>
<p>Using is very simple just run <code>./build.sh</code> and <code>open build/html/index.html</code>. You can use your favorite editor to edit sources and after that just run build again and check in browser. This version supports <a href="http://sphinx-doc.org/rest.html">reStructuredText</a> and <a href="https://help.github.com/articles/markdown-basics/">markdown</a>. You can combine both formats into your documentation. I prefer using markdown for simple text as this blog, but for complex documentation with references is better use reStructuredText (rst) format.</p>

<p>If you like write the docs, please check <a href="http://www.writethedocs.org/">Write the Docs</a> conferences and meetups.</p>

<p>See you tomorrow,<br>
Ladislav</p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page2">Older</a>
  
  
    <span class="pagination-item newer">Newer</span>
  
</div>
    </div>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-37693925-3', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>
